---
import { getCollection } from 'astro:content';

interface Props {
  category: string;
  currentSlug: string;
  limit?: number;
}

const { category, currentSlug, limit = 3 } = Astro.props;

const allPosts = await getCollection('posts');
const items = allPosts
  .filter(post => (post.data.category === category) && !currentSlug.includes(post.slug))
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf())
  .slice(0, limit)
  .map(post => ({
    url: `/posts/${post.slug}`,
    title: post.data.title,
    description: post.data.description || '',
    image: post.data.image || '',
    imageAlt: post.data.imageAlt || post.data.title,
  }));
---

{items.length > 0 && (
  <section class="my-10">
    <h2 class="text-xl font-bold mb-6 text-warmgray-700 font-display">ðŸ’› å»¶ä¼¸é–±è®€</h2>
    <div class="grid md:grid-cols-3 gap-5">
      {items.map((item) => (
        <a href={item.url} class="group block bg-white rounded-xl overflow-hidden border border-warmgray-100 hover:shadow-md transition-all">
          {item.image && (
            <img src={item.image} alt={item.imageAlt} class="w-full h-40 object-cover group-hover:scale-105 transition-transform duration-300" loading="lazy" />
          )}
          <div class="p-4">
            <h3 class="font-semibold text-warmgray-700 group-hover:text-peach-500 transition-colors line-clamp-2 text-sm">{item.title}</h3>
            <p class="text-xs text-warmgray-400 mt-2 line-clamp-2">{item.description}</p>
          </div>
        </a>
      ))}
    </div>
  </section>
)}
