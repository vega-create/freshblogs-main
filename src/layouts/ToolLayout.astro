---
import BaseLayout from './BaseLayout.astro';
import CrossSiteLinks from '../components/CrossSiteLinks.astro';
import ShareButtons from '../components/ShareButtons.astro';
import { siteConfig } from '../../site.config';

export interface Props {
  title: string;
  description: string;
  emoji: string;
  toolSlug: string;
  faq?: { q: string; a: string }[];
  relatedTools?: { name: string; emoji: string; path: string }[];
}

const { title, description, emoji, toolSlug, faq, relatedTools = [] } = Astro.props;

const pageUrl = `${siteConfig.url}/astrology/tools/${toolSlug}/`;

const breadcrumbLd = {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: siteConfig.url },
    { '@type': 'ListItem', position: 2, name: 'Astrology', item: `${siteConfig.url}/astrology/` },
    { '@type': 'ListItem', position: 3, name: 'Tools', item: `${siteConfig.url}/astrology/tools/` },
    { '@type': 'ListItem', position: 4, name: title, item: pageUrl },
  ],
};

const faqLd = faq && faq.length > 0 ? {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: faq.map((item) => ({
    '@type': 'Question',
    name: item.q,
    acceptedAnswer: { '@type': 'Answer', text: item.a },
  })),
} : null;

const webAppLd = {
  '@context': 'https://schema.org',
  '@type': 'WebApplication',
  name: title,
  description: description,
  url: pageUrl,
  applicationCategory: 'Entertainment',
  operatingSystem: 'All',
  offers: { '@type': 'Offer', price: '0', priceCurrency: 'USD' },
};

const jsonLdArray = [breadcrumbLd, webAppLd, ...(faqLd ? [faqLd] : [])];
---

<BaseLayout title={title} description={description} jsonLd={jsonLdArray}>
  <div class="max-w-3xl mx-auto px-4 py-12">
    <!-- Breadcrumb -->
    <nav class="text-sm text-gray-400 mb-6">
      <a href="/" class="hover:text-white">Home</a>
      <span class="mx-2">/</span>
      <a href="/astrology/" class="hover:text-white">Astrology</a>
      <span class="mx-2">/</span>
      <a href="/astrology/tools/" class="hover:text-white">Tools</a>
      <span class="mx-2">/</span>
      <span class="text-white">{title}</span>
    </nav>

    <!-- Header -->
    <div class="text-center mb-8">
      <span class="text-5xl mb-3 block">{emoji}</span>
      <h1 class="text-3xl md:text-4xl font-display font-bold mb-2">{title}</h1>
      <p class="text-gray-400">{description}</p>
    </div>

    <!-- Tool Component Slot -->
    <div class="mb-10">
      <slot />
    </div>

    <!-- FAQ -->
    {faq && faq.length > 0 && (
      <section class="mt-10 p-6 bg-white/5 rounded-xl border border-white/10">
        <h2 class="text-xl font-display font-bold mb-4">‚ùì FAQ</h2>
        <div class="space-y-4">
          {faq.map((item) => (
            <details class="group" open>
              <summary class="cursor-pointer font-semibold text-white hover:text-primary transition-colors list-none flex items-center justify-between gap-2">
                <span>{item.q}</span>
                <span class="text-gray-500 group-open:rotate-180 transition-transform flex-shrink-0">‚ñæ</span>
              </summary>
              <p class="mt-2 text-gray-400">{item.a}</p>
            </details>
          ))}
        </div>
      </section>
    )}

    <!-- Related Tools -->
    {relatedTools.length > 0 && (
      <section class="mt-8">
        <h2 class="text-lg font-bold mb-3">üõ†Ô∏è Related Tools</h2>
        <div class="grid sm:grid-cols-3 gap-2">
          {relatedTools.map((tool) => (
            <a
              href={`/astrology/tools/${tool.path}/`}
              class="flex items-center gap-2 p-3 bg-white/5 hover:bg-white/10 rounded-lg border border-white/10 transition-colors text-sm"
            >
              <span>{tool.emoji}</span>
              <span class="text-white">{tool.name}</span>
            </a>
          ))}
        </div>
      </section>
    )}

    <!-- Share -->
    <ShareButtons title={title} url={pageUrl} />

    <!-- Cross-site -->
    <CrossSiteLinks currentSite="astrology" />
  </div>
</BaseLayout>
